---
import { getTranslations, type Language } from '../i18n/translations';
import Reveal from './Reveal';
import YearProgress from './YearProgress';
import TechIconLink from './TechIconLink.astro';
import { TECH_ICONS, type TechCategory } from '../lib/tech-icons';
import { marked } from 'marked';
import '../styles/bio.css';

interface Props {
  lang: Language;
}

const { lang } = Astro.props;
const t = getTranslations(lang).bio;

// Parse markdown - content is from trusted translations, no sanitization needed
const descriptionHtml = marked.parse(t.description, { breaks: true }) as string;

---

<div class="relative max-w-8xl">
  <div class="bio-dots" aria-hidden="true"></div>
  
  <div class="bio-content-wrapper">
    <div class="relative z-10 mt-12 bio-main-content">
      <Reveal client:load>
        <h2 class="bio-title font-bold mb-8 leading-tight" style="font-family: var(--font-family-sans);">{t.name}<span class="bio-accent">.</span>
        </h2>
      </Reveal>
      
      <div style="display: flex; flex-direction: column;">
        <Reveal client:load delay={0.2}>
          <p class="text-2xl md:text-3xl mb-12" set:html={(() => {
            const words = t.role.split(' ');
            const parts: string[] = [];
            words.forEach((word, index) => {
              if (index > 0) parts.push(' ');
              const isMobile = word === 'Mobile';
              parts.push(`<span class="${isMobile ? 'bio-accent' : 'opacity-80'}">${word}</span>`);
            });
            return parts.join('');
          })()} />
        </Reveal>
        
        <Reveal client:load delay={0.3}>
          <p class="text-base md:text-lg opacity-70 mb-8 md:mb-12">
            {t.location} ðŸ‡¦ðŸ‡·
          </p>
        </Reveal>
      </div>
       
      <div class="description-reveal">
        <div class="text-lg md:text-xl max-w-2xl mb-12 leading-relaxed opacity-90" set:html={descriptionHtml}></div>
      
        <div class="tech-explanation">
          <p class="text-lg md:text-xl max-w-2xl mb-6 leading-relaxed opacity-90">
            {t.techExplanation.intro}
          </p>
          
          <!-- Frontend Technologies -->
          <div class="tech-category mb-6">
            <h4 class="tech-category-title">{t.techExplanation.categories.frontend}</h4>
            <div class="tech-icons">
              {TECH_ICONS.frontend.map((icon) => {
                return (
                  <TechIconLink
                    href={icon.href}
                    title={t.techExplanation.technologies[icon.titleKey]}
                    iconLight={icon.iconLight}
                    iconDark={icon.iconDark}
                    width={icon.width}
                    text={icon.showText ? t.techExplanation.technologies[icon.titleKey] : undefined}
                  />
                );
              })}
            </div>
          </div>
          
          <!-- Deployment Strategy -->
          <div class="tech-category mb-6">
            <h4 class="tech-category-title">{t.techExplanation.categories.deployment}</h4>
            <div class="tech-icons">
              {TECH_ICONS.deployment.map((icon) => {
                return (
                  <TechIconLink
                    href={icon.href}
                    title={t.techExplanation.technologies[icon.titleKey]}
                    iconLight={icon.iconLight}
                    iconDark={icon.iconDark}
                    width={icon.width}
                    text={icon.showText ? t.techExplanation.technologies[icon.titleKey] : undefined}
                  />
                );
              })}
            </div>
          </div>
          
          <!-- Version Control -->
          <div class="tech-category mb-6">
            <h4 class="tech-category-title">{t.techExplanation.categories.versionControl}</h4>
            <div class="tech-icons">
              {TECH_ICONS.versionControl.map((icon) => {
                return (
                  <TechIconLink
                    href={icon.href}
                    title={t.techExplanation.technologies[icon.titleKey]}
                    iconLight={icon.iconLight}
                    iconDark={icon.iconDark}
                    width={icon.width}
                    text={icon.showText ? t.techExplanation.technologies[icon.titleKey] : undefined}
                  />
                );
              })}
            </div>
          </div>
          
          <!-- Package Manager -->
          <div class="tech-category mb-6">
            <h4 class="tech-category-title">{t.techExplanation.categories.packageManager}</h4>
            <div class="tech-icons">
              {TECH_ICONS.packageManager.map((icon) => {
                return (
                  <TechIconLink
                    href={icon.href}
                    title={t.techExplanation.technologies[icon.titleKey]}
                    iconLight={icon.iconLight}
                    iconDark={icon.iconDark}
                    width={icon.width}
                    text={icon.showText ? t.techExplanation.technologies[icon.titleKey] : undefined}
                  />
                );
              })}
            </div>
          </div>
          
          <!-- IDE -->
          <div class="tech-category mb-6">
            <h4 class="tech-category-title">{t.techExplanation.categories.ide}</h4>
            <div class="tech-icons">
              {TECH_ICONS.ide.map((icon) => {
                return (
                  <TechIconLink
                    href={icon.href}
                    title={t.techExplanation.technologies[icon.titleKey]}
                    iconLight={icon.iconLight}
                    iconDark={icon.iconDark}
                    width={icon.width}
                    text={icon.showText ? t.techExplanation.technologies[icon.titleKey] : undefined}
                  />
                );
              })}
            </div>
          </div>
          
          <p class="text-lg md:text-xl max-w-2xl mb-6 leading-relaxed opacity-90">
            {t.techExplanation.whyWebpage}
          </p>
          <p class="text-lg md:text-xl max-w-2xl mb-12 leading-relaxed opacity-90">
            {t.techExplanation.mobileVsWeb}
          </p>
        </div>
      </div>
      <div class="year-progress-wrapper year-progress-sticky">
        <YearProgress client:load lang={lang} />
      </div>
    </div>
    
  </div>