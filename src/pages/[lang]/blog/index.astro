---
import { getCollection } from 'astro:content';
import BaseLayout from '../../../layouts/BaseLayout.astro';
import TimelineItem from '../../../components/TimelineItem.astro';
import { getTranslations, type Language } from '../../../i18n/translations';

export function getStaticPaths() {
  return [
    { params: { lang: 'es' } },
    { params: { lang: 'en' } },
  ];
}

const { lang } = Astro.params as { lang: Language };
const t = getTranslations(lang).blog;

const allPosts = await getCollection('blog', ({ data }) => {
  return data.language === lang;
});

const sortedPosts = allPosts.sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());

const formatDate = (date: Date, locale: string) => {
  return new Intl.DateTimeFormat(locale, {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  }).format(date);
};
---

<BaseLayout 
  title={t.title} 
  description={t.description}
  lang={lang}
>
  <div class="max-w-4xl">
    <h1 class="text-5xl md:text-6xl font-serif font-bold mb-16">{t.heading}</h1>
    
    <div class="timeline">
      {sortedPosts.map((post, index) => {
        const slug = post.slug.replace(`${post.data.language}/`, '');
        const isHighlighted = index % 3 === 0;
        return (
          <TimelineItem
            title={post.data.title}
            date={formatDate(post.data.pubDate, lang)}
            description={post.data.description}
            href={`/${lang}/blog/${slug}`}
            isHighlighted={isHighlighted}
          />
        );
      })}
    </div>
  </div>
</BaseLayout>

<style>
  .timeline {
    position: relative;
    padding-left: 3rem;
    margin-left: 1rem;
  }

  .timeline::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 2px;
    background-color: var(--timeline-line);
  }
</style>
