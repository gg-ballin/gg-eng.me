---
import { getTranslations, type Language } from '@/i18n/translations';

interface Props {
  title: string;
  description?: string;
  lang: Language;
}

const { title = 'Germán Gomez', description = '', lang } = Astro.props;
const currentPath = Astro.url.pathname;
const t = getTranslations(lang).nav;

// Language switcher logic
const otherLang = lang === 'es' ? 'en' : 'es';
const switcherPath = currentPath.replace(`/${lang}/`, `/${otherLang}/`);
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
    <script is:inline>
      // Theme initialization (runs before page render to prevent flash)
      const theme = localStorage.getItem('theme') || 'light';
      document.documentElement.setAttribute('data-theme', theme);
    </script>
  </head>
  <body class="min-h-screen">
    <nav class="nav-bar max-w-6xl mx-auto px-6 py-8 flex justify-between items-center">
      <div class="flex gap-8">
        <a href={`/${lang}/`} class="hover:opacity-60 transition-opacity">{t.bio}</a>
        <a href={`/${lang}/blog`} class="hover:opacity-60 transition-opacity">{t.blog}</a>
        <a href={`/${lang}/contact`} class="hover:opacity-60 transition-opacity">{t.contact}</a>
      </div>
      <div class="flex gap-4 items-center">
        <button 
          id="theme-toggle" 
          class="text-sm hover:opacity-60 transition-opacity uppercase tracking-wider"
          aria-label={t.theme}
        >
          <span id="theme-icon">◐</span>
        </button>
        <a href={switcherPath} class="text-sm hover:opacity-60 transition-opacity uppercase tracking-wider">
          {otherLang}
        </a>
      </div>
    </nav>
    <main class="main-content max-w-6xl mx-auto px-6 py-8">
      <slot />
    </main>

    <script>
      // Theme toggle functionality
      const themeToggle = document.getElementById('theme-toggle');
      const themeIcon = document.getElementById('theme-icon');
      
      function updateThemeIcon() {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        if (themeIcon) {
          themeIcon.textContent = currentTheme === 'dark' ? '☀' : '☾';
        }
      }
      
      // Set initial icon
      updateThemeIcon();
      
      themeToggle?.addEventListener('click', () => {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
        updateThemeIcon();
      });
    </script>
  </body>
</html>

<style is:global>
  @import '../styles/global.css';
  
  /* Light theme specific backgrounds */
  .nav-bar {
    background-color: #F7F8FA;
  }
  
  .main-content {
    background-color: #F5F4EF;
  }
  
  /* Dark theme specific backgrounds */
  [data-theme="dark"] .nav-bar {
    background-color: #000408;
  }
  
  [data-theme="dark"] .main-content {
    background-color: #0D1117;
  }
</style>
